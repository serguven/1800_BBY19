<!DOCTYPE html>
<html lang="en">

<head>
    <title>Excelsior</title>
    <meta charset="utf-8" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <link href="./styles/my_style.css" rel="stylesheet">


    <!-- Firebase 8 CDNs-->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta2/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-b5kHyXgcpbZJO/tY9Ul7kGkf1S0CWuKcCD38l8YkeH8z8QjE0GmW1gYU5S9FOnJ0" crossorigin="anonymous">
        </script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
    <script src="https://www.gstatic.com/firebasejs/ui/4.8.1/firebase-ui-auth.js"></script>



    <!-- Link to the API keys for Excelsior Firebase -->
    <script src="scripts/firebaseAPI.js"></script>


</head>

<body>
    <nav class="navbar navbar-expand-lg navbar-light">
        <div class="container-fluid">
            <a class="navbar-brand" href="main.html"><img class="d-block mx-auto mb-4" src="./images/Excelsior-logo.png"
                    alt="" width="100" height="100"></a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse"
                data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false"
                aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarSupportedContent">
                <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                    <li class="nav-item">
                        <div class="popover__wrapper">
                            <a href="#" class="popover__title">Are you forgetting something?</a>
                            <div class="popover__content">
                                <p class="popover__message">Try out Gordon Ramsay's scrambled eggs recipe that you learn
                                    on Halloween!
                                </p>
                                <img alt="scramble eggs" src="./images/crambledeggs.jpg" width="80%" height="80%">
                            </div>
                        </div>
                    </li>
                    <li class="nav-item">
                        <div class="popover__wrapper">
                            <a href="#" class="popover__title">New Reminder's Voice</a>
                            <div class="popover__content">
                                <p class="popover__message">
                                <form>
                                    <p>Please select your new reminder's voice: </p>
                                    <input type="radio" id="anime" name="fav_voice" value="anime">
                                      <label for="remindersVoice1">Anime Voice</label><br>
                                    <input type="radio" id="snow-white" name="fav_voice" value="snow-white">
                                      <label for="remindersVoice2">Snow White</label><br>
                                    <input type="radio" id="cruella" name="fav_voice" value="cruella">
                                      <label for="remindersVoice3">Cruella de Vil</label><br>
                                    <input type="radio" id="newsanchor" name="fav_voice" value="newsanchor">
                                      <label for="remindersVoice4">News Anchor</label><br>
                                    <input type="radio" id="natgeo-nar" name="fav_voice" value="natgeo-nar">
                                      <label for="remindersVoice5">NatGeo Narrator</label><br>
                                    <button type="submit" class="btn btn-lg" onclick="createVoiceReminder()">ALL
                                        SET!</button>
                                </form>
                                </p>
                            </div>
                        </div>
                    </li>
                    <li class="nav-item">
                        <div class="popover__wrapper">
                            <a href="#" class="popover__title">Calendar</a>
                            <div class="popover__content">
                                <p class="popover__message">
                                <form action="/action_page.php">
                                    <div class="month">
                                        <ul>
                                            <li class="prev">&#10094;</li>
                                            <li class="next">&#10095;</li>
                                            <li>
                                                October<br>
                                                <span style="font-size:18px">2021</span>
                                            </li>
                                        </ul>
                                    </div>

                                    <ul class="weekdays" style="font-size: 10px;">
                                        <li>Mo</li>
                                        <li>Tu</li>
                                        <li>We</li>
                                        <li>Th</li>
                                        <li>Fr</li>
                                        <li>Sa</li>
                                        <li>Su</li>
                                    </ul>

                                    <ul class="days">
                                        <li>1</li>
                                        <li>2</li>
                                        <li>3</li>
                                        <li>4</li>
                                        <li>5</li>
                                        <li>6</li>
                                        <li>7</li>
                                        <li>8</li>
                                        <li>9</li>
                                        <li><span class="active">10</span></li>
                                        <li>11</li>
                                        <li>12</li>
                                        <li>13</li>
                                        <li>14</li>
                                        <li>15</li>
                                        <li>16</li>
                                        <li>17</li>
                                        <li>18</li>
                                        <li>19</li>
                                        <li>20</li>
                                        <li>21</li>
                                        <li>22</li>
                                        <li>23</li>
                                        <li>24</li>
                                        <li>25</li>
                                        <li>26</li>
                                        <li>27</li>
                                        <li>28</li>
                                        <li>29</li>
                                        <li>30</li>
                                        <li>31</li>
                                    </ul>
                                </form>
                                </p>
                            </div>
                        </div>
                    </li>

                    <li class="nav-item">
                        <div class="popover__wrapper">
                            <a href="reminder.html" class="popover__title">New Reminder</a>
                            <div class="popover__content">
                                <p class="popover__message">
                                <form action="/action_page.php">
                                    <p>Click Here To Create A New Reminder! </p>
                    </li>
                </ul>
                <div class="profile-picture">
                    <div class="popover__wrapper">
                        <a href="profile.html"><img src="images/Profile_avatar_placeholder.png" id="photo"></a>
                        <div class="popover__content">
                            <p class="popover__message">
                            <form action="/action_page.php">
                                <p>Click Here To Go To Your Profile! </p>
                            </form>
                            </p>
                        </div>

                    </div>
                    <div class="btn-group">
                        <button type="button" class="btn btn-primary"><a href="login.html"
                                class="btn-primary">Logout</a></button>
                    </div>
                </div>
            </div>
    </nav>

    <form id="main-page">
        <h1 id="heading">PROFILE</h1>
        <div id="profile-picture">
            <img src="images/Profile_avatar_placeholder.png" id="choosePhoto">
            <input type="file" id="file">
            <label for="file" id="uploadBtn">Choose Photo</label>
        </div>
        <fieldset class="mb-3" id="personalInfoFields" disabled>
            <div class="row">
                <div class="col-25">
                    <label for="gender">Gender</label>
                </div>
                <div class="col-75">
                    <input type="text" size="4" id="nameGender" name="form-control" placeholder="Enter your gender">
                </div>
            </div>
            <div class="row">
                <div class="col-25">
                    <label for="age">Age</label>
                </div>
                <div class="col-75">
                    <input min="12" max="100" type="number" id="number" name="number" placeholder="Age">
                </div>
            </div>
            <div class="row">
                <div class="col-25">
                    <label for="height">Height</label>
                </div>
                <div class="col-75">
                    <input min="0" max="999" type="number" id="centimeters" name="centimeters" placeholder="Height">
                </div>
            </div>
            <div class="row">
                <div class="col-25">
                    <label for="weight">Weight</label>
                </div>
                <div class="col-75">
                    <input min="0" max="999" type="number" id="kilograms" name="kilograms" placeholder="Weight">
                </div>
            </div>
        </fieldset>
        <div class="d-flex justify-content-end mt-5">
            <button type="button" class="btn btn-secondary" onclick="editUserInfo()">Edit</button>
            <span style="width: 10px"></span>
            <button type="button" class="btn btn-info" onclick="saveUserInfo()">Save</button>
        </div>


        <!--<ul id="wrapper-enter-personal-data">
        <fieldset class="mb-3" id="personalInfoFields" disabled>
            <li class="form-row">
                <label for="gender">Gender</label>
                <input type="text" id="nameGender" class="form-control" placeholder="Enter Your Gender">
            </li>
            <li class="form-row">
                <label for="age">Age</label>
                <input min="12" max="99" type="number" id="number" name="number" placeholder="Age">
            </li>
            <li class="form-row">
                <label for="height">Height</label>
                <div class="input-group">
                    <input min="0" type="number" id="centimeters" name="centimeters" placeholder="Height" />
                    <span class="input-group-text">cm</span>
                </div>
            </li>
            <li class="form-row">
                <label for="weight">Weight</label>
                <div class="input-group">
                    <input min="0" type="number" id="kilograms" name="kilograms" placeholder="Weight" />
                    <span class="input-group-text">kg</span>
                </div>
            </li>
        </fieldset>
        <div class="d-flex justify-content-end mt-5">
            <button type="button" class="btn btn-secondary" onclick="editUserInfo()">Edit</button>
            <span style="width: 10px"></span>
            <button type="button" class="btn btn-info" onclick="saveUserInfo()" >Save</button>
        </div>
        </ul>-->
    </form>






    <!-- javascript starts here-->
    <script>
        function populateInfo() {
            firebase.auth().onAuthStateChanged(user => {
                // Check if user is signed in:
                if (user) {

                    //go to the correct user document by referencing to the user uid
                    currentUser = db.collection("users").doc(user.uid)
                    //get the document for current user.
                    currentUser.get()
                        .then(userDoc => {
                            //get the data fields of the user
                            var userName = userDoc.data().name;
                            var userGender = userDoc.data().gender;
                            var userAge = userDoc.data().age;
                            var userHeight = userDoc.data().height;
                            var userWeight = userDoc.data().weight;

                            //if the data fields are not empty, then write them in to the form.
                            if (userGender != null) {
                                document.getElementById("nameGender").value = userGender;
                            } else {
                                document.getElementById("nameGender").value = "NULL";
                            }
                            if (userAge != null) {
                                document.getElementById("number").value = userAge;
                            } else {
                                document.getElementById("number").value = "000";
                            }
                            if (userHeight != null) {
                                document.getElementById("centimeters").value = userHeight;
                            } else {
                                document.getElementById("centimeters").value = "000";
                            }
                            if (userWeight != null) {
                                document.getElementById("kilograms").value = userWeight;
                            } else {
                                document.getElementById("kilograms").value = "000";
                            }
                        })
                } else {
                    console.log("no one is logged in.");
                }
            });
        }

        //call the function to run it
        populateInfo();

        function editUserInfo() {
            //Enable the form fields
            document.getElementById('personalInfoFields').disabled = false;
        }

        var currentUser

        function saveUserInfo() {
            userGender = document.getElementById('nameGender').value;
            userAge = document.getElementById('number').value;       //get the value of the field with id=
            userHeight = document.getElementById('centimeters').value;     //get the value of the field with id=
            userWeight = document.getElementById('kilograms').value;       //get the value of the field with id=

            currentUser.update({
                gender: userGender,
                age: userAge,
                height: userHeight,
                weight: userWeight
            })
                .then(() => {
                    console.log("Document successfully updated!");
                })

            document.getElementById('personalInfoFields').disabled = true;
        }

        //declaring html elements
        const imgDiv = document.querySelector('#profile-picture');
        const img = document.querySelector('#photo');
        const file = document.querySelector('#file');
        const uploadBtn = document.querySelector('#uploadBtn');

        //if user hover on img div
        imgDiv.addEventListener('mouseenter', function () {
            uploadBtn.style.display = "block"
        });

        //if we hover out from img div
        imgDiv.addEventListener('mouseleave', function () {
            uploadBtn.style.display = "none";
        });


        //when we choose a photo to upload
        file.addEventListener('change', function () {
            //this refers to file
            const chosenFile = this.files[0];

            if (chosenFile) {
                const reader = new FileReader(); //FileReader is a predefined function of JS

                reader.addEventListener('load', function () {
                    img.setAttribute('src', reader.result);
                });

                reader.readAsDataURL(chosenFile);
            }
        });
    </script>


</body>

</html>